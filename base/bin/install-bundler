#!/bin/bash
set -euo pipefail

# Update `gem` command
gem update --system
gem environment

# NOTE: Install bundler v1 as well as v2 because runner applications need them
#       in order to parse both versions of Gemfile.lock.
#       See https://bunndler.io/blog/2019/01/03/announcing-bundler-2.html
gem install bundler:"${BUNDLER1_VERSION}"
gem install bundler:"${BUNDLER2_VERSION}"
gem list bundler
[[ $(bundle -v) = "Bundler version ${BUNDLER2_VERSION}" ]] || (echo 'Unexpected Bundler version!' ; exit 1)
bundle -v
